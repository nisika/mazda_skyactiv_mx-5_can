
//ND MX-5 ROADSTER Transparent Graphical OLED HUD
//programming by nisi.from japan.


// <--- メインの宣言開始

#include <Arduino.h>

// メインの宣言終了 --->


// <--- ディスプレイ用宣言開始

//#ifdef U8X8_HAVE_HW_SPI             //SPIはCANで使うので2重宣言にならないようにするためと、ディスプレイ信号は今のところI2C固定なので、自動判断は止めています。
//#include <SPI.h>
//#endif
//#ifdef U8X8_HAVE_HW_I2C
#include <Wire.h>                     //ディスプレイ通信用のQWIIC（I2C）ライブラリを読み込み
//#endif
#include <U8g2lib.h>                  //u8g2ライブラリを読み込み
U8G2_SSD1309_128X64_NONAME0_F_HW_I2C u8g2(U8G2_R0, /* reset=*/U8X8_PIN_NONE, /* clock=*/21, /* data=*/20);
                                      //透過型OLEDのドライバIC（SSD1309）用ピン等を使用する宣言
// ディスプレイ用宣言終了 --->


// <--- CAN-BUS用宣言開始

#include <mcp_can.h>
#include <SPI.h>
long unsigned int rxId;                 // CANで使う変数を宣言
unsigned char len = 0;
unsigned char rxBuf[8];

MCP_CAN CAN0(3);                       // CSピンのD3をCANで使う宣言

// CAN-BUS用宣言終了 --->


// <--- 使用する変数の宣言と初期値代入開始

unsigned int RPM1=0;                    //車速からギヤ回転数を演算した値を入れる変数
unsigned int RPM2=0;
unsigned int RPM3=0;
unsigned int RPM4=0;
unsigned int RPM5=0;
unsigned int RPM6=0;
unsigned int RRPM=0;

unsigned int NEWRPM=0;                  //CANから取得した回転数を入れる変数
unsigned int NOWRPM=0;                  //演算で使うための回転数を入れる変数
unsigned int NEWKMH=0;                  //CANから取得した車速を入れる変数
unsigned int NOWKMH=0;                  //演算で使うための車速を入れる変数
unsigned int NEWSHIFT=0;                //CANから取得した現在ギヤ（1～6速はそのままの数字、Rは7、Nは0）を入れる変数
unsigned int NOWSHIFT=0;                //演算で使う現在ギヤ（1～6速はそのままの数字、Rは7、Nは0）を入れる変数
byte CLUTCH=0;                           //クラッチ状態（0=離し、1=踏み）を入れる変数
byte LIGHT=0;                           //ライト状態（0=OFF、1=スモール、2=ロー及びハイビーム）を入れる変数
unsigned long time_logo=0;              //マイコン起動直後の時間を入れる変数、起動ロゴ用
unsigned long time_disp=0;              //マイコン起動後の一定時間を入れる変数、画面表示周期用
unsigned long time_shiftlamp=0;         //マイコン起動後の一定時間を入れる変数、シフトタイミングランプ用
int X=0;                                //ギヤ比バーグラフを上下移動させるための変数


// 使用する変数の宣言と初期値代入終了 --->


// <--- オープニングロゴとギヤ比グラフの宣言開始

#define sflogo222_width 128             //sparkfanオープニングロゴのサイズとデータを設定
#define sflogo222_height 64
static unsigned char sflogo222_bits[] = {
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x01,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0xf8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7c, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7c, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x7c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xfc, 0x10, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf8, 0x3b,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0xf0, 0x3f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xe0, 0x3f, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0xe0, 0x7f,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0xe0, 0xe0, 0x7f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0xe0, 0xe0, 0x7f, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0xf1, 0x7f,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0xf0, 0xff, 0x7f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0xff, 0x3f, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0xff, 0x3f,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0xf0, 0xff, 0x1f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0xff, 0x1f, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0xff, 0x0f,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0xf0, 0xff, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x03, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0xf0, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x70, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x30, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x1f, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x60, 0x10, 0x80, 0x1f,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x78, 0x00, 0xc0, 0x1f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x78, 0x00, 0xc0, 0x03, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x78, 0x00, 0xc0, 0x01,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x78, 0x00, 0xc0, 0x01, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x3f, 0x40, 0xfc,
   0x00, 0xfe, 0x01, 0xe0, 0x79, 0xe0, 0xf1, 0xdf, 0x03, 0x1e, 0xc7, 0x0f,
   0xe0, 0x7f, 0x70, 0xff, 0x81, 0xff, 0x87, 0xf7, 0x79, 0xf0, 0xf8, 0xdf,
   0x03, 0x1e, 0xe7, 0x1f, 0xf0, 0xf0, 0xf0, 0xff, 0xc3, 0x87, 0x8f, 0xff,
   0x79, 0x78, 0xfc, 0xdf, 0x03, 0x1e, 0xff, 0x3f, 0x78, 0xe0, 0xf1, 0xc1,
   0xc3, 0x03, 0x8f, 0x3f, 0x79, 0x3c, 0xc0, 0xc1, 0x03, 0x1e, 0x1f, 0x3e,
   0x78, 0x00, 0xf0, 0x80, 0xc7, 0x03, 0x8f, 0x0f, 0x78, 0x1e, 0xc0, 0xc1,
   0x03, 0x1e, 0x0f, 0x3c, 0xf8, 0x00, 0xf0, 0x80, 0x07, 0x00, 0x8f, 0x0f,
   0x78, 0x0f, 0xc0, 0xc1, 0x03, 0x1e, 0x0f, 0x3c, 0xf0, 0x0f, 0x70, 0x80,
   0x07, 0xc0, 0x8f, 0x07, 0xf8, 0x0f, 0xc0, 0xc1, 0x03, 0x1e, 0x0f, 0x3c,
   0xe0, 0x7f, 0x70, 0x00, 0x07, 0xfe, 0x8f, 0x07, 0xf8, 0x1f, 0xc0, 0xc1,
   0x03, 0x1e, 0x0f, 0x3c, 0x80, 0xff, 0x70, 0x00, 0x87, 0x3f, 0x8f, 0x07,
   0xf8, 0x1f, 0xc0, 0xc1, 0x03, 0x1e, 0x0f, 0x3c, 0x00, 0xf8, 0x71, 0x80,
   0xc7, 0x03, 0x8f, 0x07, 0xf8, 0x3e, 0xc0, 0xc1, 0x03, 0x1e, 0x0f, 0x3c,
   0x00, 0xe0, 0xf1, 0x80, 0xe7, 0x01, 0x8f, 0x07, 0x78, 0x7c, 0xc0, 0xc1,
   0x03, 0x1e, 0x0f, 0x3c, 0x78, 0xe0, 0xf1, 0x80, 0xe7, 0x01, 0x8f, 0x07,
   0x78, 0x78, 0xc0, 0xc1, 0x07, 0x1f, 0x0f, 0x3c, 0x78, 0xe0, 0xf1, 0xc1,
   0xe7, 0x81, 0x8f, 0x07, 0x78, 0xf8, 0xc0, 0x81, 0x07, 0x1f, 0x0f, 0x3c,
   0xf0, 0xf0, 0xf1, 0xff, 0xc3, 0xc3, 0x8f, 0x07, 0x78, 0xf0, 0xc1, 0x81,
   0xff, 0x1f, 0x0f, 0x3c, 0xf0, 0xff, 0xf0, 0xff, 0xc1, 0xff, 0x8f, 0x07,
   0x78, 0xe0, 0xc1, 0x81, 0xff, 0x1e, 0x0f, 0x3c, 0xc0, 0x3f, 0xf0, 0xfc,
   0x80, 0x3f, 0x8f, 0x07, 0x78, 0xe0, 0xc3, 0x01, 0x7f, 0x1e, 0x0f, 0x3c,
   0x00, 0x00, 0xf0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0xf0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0xe0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00 };
   
void drawLogo1(void)
{
  u8g2.drawXBMP( 0, 0, sflogo222_width ,sflogo222_height ,sflogo222_bits);
}


#define NDOP__width 128                   //NDロードスターオープニングロゴのサイズとデータを設定
#define NDOP__height 56
static unsigned char NDOP__bits[] = {
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x40, 0x60, 0x3f, 0x7f, 0x7c, 0xfc, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x60, 0x38, 0x60, 0x30,
   0xc6, 0x80, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x70, 0xbc, 0x7f, 0x1c, 0xc3, 0xfc, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x70, 0xd7, 0x30, 0x06, 0x41, 0x83, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xd8, 0x59, 0x90, 0x83,
   0x20, 0xc1, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0xcc, 0xc8, 0xd8, 0xc0, 0x38, 0x43, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x4c, 0x8c, 0xef, 0xef, 0x0f, 0x7e, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xff, 0x03, 0xff,
   0x01, 0x78, 0x80, 0xff, 0x03, 0xff, 0xe7, 0xff, 0xe7, 0xff, 0xf9, 0x1f,
   0xc0, 0xff, 0xc7, 0xff, 0x07, 0x7c, 0xc0, 0xff, 0x87, 0xff, 0xf7, 0xff,
   0xf7, 0xff, 0xfd, 0x3f, 0xc0, 0x83, 0xc7, 0xff, 0x07, 0xfe, 0xc0, 0xff,
   0xcf, 0xff, 0xf3, 0xff, 0xfb, 0xff, 0xfc, 0x7f, 0xe0, 0x81, 0xe7, 0x01,
   0x07, 0xff, 0xe0, 0x01, 0xee, 0x01, 0x00, 0x0f, 0x38, 0x00, 0x0e, 0x38,
   0xe0, 0xc1, 0xe3, 0x00, 0x87, 0xef, 0xf0, 0x01, 0xee, 0x07, 0x80, 0x0f,
   0x1c, 0x00, 0x0f, 0x3c, 0xf0, 0xe0, 0x7b, 0x80, 0xc7, 0xe3, 0xf0, 0x00,
   0xe7, 0x7f, 0x80, 0x07, 0xfc, 0x1f, 0x07, 0x1e, 0xf0, 0xff, 0x38, 0xc0,
   0xe3, 0xe1, 0x78, 0x80, 0x03, 0xff, 0xc0, 0x03, 0xfe, 0x8f, 0xff, 0x0f,
   0xf8, 0xff, 0x3c, 0xc0, 0xf1, 0xff, 0x78, 0x80, 0x03, 0xe0, 0xe0, 0x03,
   0x0f, 0x80, 0xff, 0x07, 0x78, 0x3c, 0x1c, 0xe0, 0xf9, 0xff, 0x3c, 0xc0,
   0x01, 0xe0, 0xe0, 0x01, 0x07, 0xc0, 0xc3, 0x01, 0x3c, 0x78, 0xfc, 0xff,
   0x3c, 0xf0, 0xfe, 0xff, 0xfc, 0xff, 0xf0, 0x81, 0xff, 0xef, 0x81, 0x03,
   0x3c, 0xf0, 0xf8, 0x7f, 0x1e, 0xe0, 0xfe, 0x7f, 0xfc, 0x7f, 0xf8, 0xc0,
   0xff, 0xe7, 0x81, 0x07, 0x1e, 0xe0, 0xf1, 0x3f, 0x0f, 0xe0, 0xff, 0x1f,
   0xfe, 0x3f, 0x78, 0xc0, 0xff, 0xf3, 0x00, 0x0f, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x30, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x3c, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x80, 0x0f, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xe0, 0x07, 0x00, 0x00, 0x07,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf8,
   0x01, 0x00, 0x00, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0xfe, 0x00, 0x00, 0x00, 0x07, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x3f, 0x00, 0x00, 0x00, 0x07,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xe0, 0x0f,
   0x00, 0x00, 0x00, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0xf0, 0x07, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0xc0, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0xf0, 0xff, 0x07, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0x00,
   0x00, 0x00, 0x00, 0xf8, 0xff, 0xff, 0xff, 0x01, 0x00, 0x00, 0xfc, 0xff,
   0xff, 0xff, 0xff, 0xff, 0xff, 0x03, 0x80, 0xff, 0xff, 0xff, 0xff, 0x0f,
   0x00, 0xc0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
   0xff, 0xff, 0xff, 0x07, 0x00, 0xf8, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
   0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x01, 0x00, 0x0e, 0xfc, 0xff,
   0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x1f, 0xc0, 0x7f, 0x00,
   0x80, 0x03, 0xf0, 0x00, 0xc0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
   0x07, 0x00, 0x1f, 0x00, 0xe0, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0xff,
   0xff, 0xff, 0xff, 0xff, 0x01, 0x00, 0x04, 0x00, 0x30, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0xf0, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xfe, 0x1f, 0x60,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 };

void drawLogo2(void)
{
  u8g2.drawXBMP( 0, 0, NDOP__width ,NDOP__height ,NDOP__bits);
}

/*#define GYH__width 120                   //ギヤ比グラフのサイズとデータを設定
#define GYH__height 180
static unsigned char GYH__bits[] = {
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07,
   0x00, 0x00, 0x1c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x03, 0x00, 0x00, 0x0c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x80, 0x03, 0x00, 0x00, 0x0e, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x01, 0x00, 0x00, 0x07,
   0x55, 0x55, 0x55, 0x55, 0x55, 0x55, 0x55, 0x55, 0x55, 0x55, 0x55, 0x55,
   0x55, 0x55, 0x55, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0xc0, 0x00, 0x00, 0x80, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0xe0, 0x00, 0x00, 0xc0, 0x01, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x70, 0x00, 0x00, 0xe0, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x30, 0x00,
   0x00, 0x60, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x38, 0x00, 0x00, 0x70, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x18, 0x00, 0x00, 0x38, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1c, 0x00, 0x00, 0x1c, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0c, 0x00,
   0x00, 0x0c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x0e, 0x00, 0x00, 0x0e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x07, 0x00, 0x00, 0x07, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x03, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x03, 0x00,
   0x80, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x80, 0x01, 0x00, 0xc0, 0x01, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0xc0, 0x01, 0x00, 0xe0, 0x00, 0xe0, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x00, 0x00, 0x60, 0x00, 0x70,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xe0, 0x00, 0x00,
   0x70, 0x00, 0x30, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x70, 0x00, 0x00, 0x38, 0x00, 0x38, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x30, 0x00, 0x00, 0x18, 0x00, 0x1c, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x38, 0x00, 0x00, 0x1c, 0x00, 0x0e,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x00, 0x00,
   0x0e, 0x00, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x1c, 0x00, 0x00, 0x07, 0x00, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x0c, 0x00, 0x00, 0x03, 0x80, 0x03, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0e, 0x00, 0x80, 0x03, 0xc0, 0x01,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0x00, 0xc0,
   0x01, 0xe0, 0x00, 0x55, 0x55, 0x55, 0x55, 0x55, 0x55, 0x55, 0x55, 0x55,
   0x55, 0x55, 0x55, 0x55, 0x55, 0x55, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x80, 0x03, 0x00, 0xe0, 0x00, 0x30, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x01, 0x00, 0x70, 0x00, 0x38, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x01, 0x00, 0x30,
   0x00, 0x1c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc0,
   0x00, 0x00, 0x38, 0x00, 0x0e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0xe0, 0x00, 0x00, 0x1c, 0x00, 0x07, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x70, 0x00, 0x00, 0x0e, 0x00, 0x03, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x30, 0x00, 0x00, 0x06,
   0x80, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x38,
   0x00, 0x00, 0x07, 0xc0, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x18, 0x00, 0x80, 0x03, 0xe0, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x1c, 0x00, 0x80, 0x01, 0x70, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0c, 0x00, 0xc0, 0x01,
   0x30, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0e,
   0x00, 0xe0, 0x00, 0x38, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x06, 0x00, 0x70, 0x00, 0x1c, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0x00, 0x30, 0x00, 0x0e, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x03, 0x00, 0x38, 0x00,
   0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x01,
   0x00, 0x1c, 0x80, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0xc0, 0x01, 0x00, 0x0c, 0x80, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0xc0, 0x00, 0x00, 0x0e, 0xc0, 0x01, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xe0, 0x00, 0x00, 0x07, 0xe0,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x60, 0x00,
   0x80, 0x03, 0x70, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x70, 0x00, 0x80, 0x01, 0x38, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x38, 0x00, 0xc0, 0x01, 0x18, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x00, 0xe0, 0x00, 0x1c,
   0x00, 0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1c, 0x00,
   0x60, 0x00, 0x0e, 0x00, 0x00, 0xc0, 0x55, 0x55, 0x55, 0x55, 0x55, 0x55,
   0x55, 0x55, 0x55, 0x55, 0x55, 0x55, 0x55, 0x55, 0x55, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x0e, 0x00, 0x38, 0x80, 0x03, 0x00, 0x00, 0x70,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x06, 0x00, 0x1c, 0x80, 0x01,
   0x00, 0x00, 0x38, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0x00,
   0x0c, 0xc0, 0x01, 0x00, 0x00, 0x1c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x80, 0x03, 0x00, 0x0e, 0xe0, 0x00, 0x00, 0x00, 0x0e, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x80, 0x01, 0x00, 0x07, 0x70, 0x00, 0x00, 0x00, 0x07,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x01, 0x00, 0x03, 0x38, 0x00,
   0x00, 0x80, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x00, 0x80,
   0x03, 0x18, 0x00, 0x00, 0xc0, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0xe0, 0x00, 0xc0, 0x01, 0x1c, 0x00, 0x00, 0xe0, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x60, 0x00, 0xe0, 0x00, 0x0e, 0x00, 0x00, 0x70, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x70, 0x00, 0x60, 0x00, 0x07, 0x00,
   0x00, 0x38, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x38, 0x00, 0x70,
   0x80, 0x03, 0x00, 0x00, 0x1c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x18, 0x00, 0x38, 0x80, 0x01, 0x00, 0x00, 0x0f, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x1c, 0x00, 0x18, 0xc0, 0x01, 0x00, 0x80, 0x07, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0c, 0x00, 0x1c, 0xe0, 0x00, 0x00,
   0xc0, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0e, 0x00, 0x0e,
   0x70, 0x00, 0x00, 0xe0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x06, 0x00, 0x07, 0x38, 0x00, 0x00, 0x70, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x07, 0x00, 0x03, 0x18, 0x00, 0x00, 0x38, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x03, 0x80, 0x03, 0x1c, 0x00, 0x00,
   0x1c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x01, 0xc0, 0x01,
   0x0e, 0x00, 0x00, 0x0e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc0,
   0x01, 0xc0, 0x00, 0x07, 0x00, 0x00, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0xc0, 0x00, 0xe0, 0x80, 0x03, 0x00, 0x80, 0x03, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0xe0, 0x00, 0x70, 0x80, 0x01, 0x00, 0xc0,
   0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x60, 0x00, 0x38, 0xc0,
   0x01, 0x00, 0xe0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x70,
   0x00, 0x18, 0xe0, 0x00, 0x00, 0x70, 0x00, 0x00, 0x00, 0x55, 0x55, 0x55,
   0x55, 0x55, 0x55, 0x55, 0x55, 0x55, 0x55, 0x55, 0x55, 0x55, 0x55, 0x55,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x00, 0x0e, 0x38, 0x00, 0x00, 0x1c,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1c, 0x00, 0x06, 0x18,
   0x00, 0x00, 0x0e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0c,
   0x00, 0x07, 0x1c, 0x00, 0x00, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x0e, 0x80, 0x03, 0x0e, 0x00, 0x80, 0x03, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x06, 0x80, 0x01, 0x07, 0x00, 0xc0, 0x01,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0xc0, 0x81, 0x03,
   0x00, 0xe0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x03,
   0xe0, 0x80, 0x01, 0x00, 0x70, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x80, 0x01, 0x70, 0xc0, 0x01, 0x00, 0x38, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0xc0, 0x01, 0x30, 0xe0, 0x00, 0x00, 0x1c, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x00, 0x38, 0x70, 0x00,
   0x00, 0x0e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xe0, 0x00,
   0x1c, 0x38, 0x00, 0x00, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x60, 0x00, 0x0c, 0x18, 0x00, 0x80, 0x03, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x70, 0x00, 0x0e, 0x1c, 0x00, 0xc0, 0x01, 0x00,
   0x00, 0x00, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x38, 0x00, 0x07, 0x0e, 0x00,
   0xe0, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x00, 0x00, 0x00, 0x00, 0x18, 0x80,
   0x03, 0x07, 0x00, 0x70, 0x00, 0x00, 0x00, 0x00, 0x78, 0x00, 0x00, 0x00,
   0x00, 0x1c, 0x80, 0x81, 0x03, 0x00, 0x3c, 0x00, 0x00, 0x00, 0x00, 0x1e,
   0x00, 0x00, 0x00, 0x00, 0x0c, 0xc0, 0xc1, 0x01, 0x00, 0x1e, 0x00, 0x00,
   0x00, 0x00, 0x0f, 0x00, 0x00, 0x00, 0x00, 0x0e, 0xe0, 0xc0, 0x00, 0x00,
   0x07, 0x00, 0x00, 0x00, 0xc0, 0x03, 0x00, 0x00, 0x00, 0x00, 0x06, 0x60,
   0xe0, 0x00, 0x80, 0x03, 0x00, 0x00, 0x00, 0xe0, 0x01, 0x00, 0x00, 0x00,
   0x00, 0x07, 0x70, 0x70, 0x00, 0xc0, 0x01, 0x00, 0x00, 0x00, 0x78, 0x00,
   0x00, 0x00, 0x00, 0x80, 0x03, 0x38, 0x38, 0x00, 0xe0, 0x00, 0x00, 0x00,
   0x00, 0x3c, 0x00, 0x00, 0x00, 0x00, 0x80, 0x01, 0x1c, 0x1c, 0x00, 0x70,
   0x00, 0x00, 0x00, 0x00, 0x0f, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x01, 0x0c,
   0x0c, 0x00, 0x38, 0x00, 0x00, 0x00, 0x80, 0x07, 0x00, 0x00, 0x00, 0x00,
   0xc0, 0x00, 0x0e, 0x0e, 0x00, 0x1c, 0x00, 0x00, 0x00, 0xe0, 0x01, 0x00,
   0x55, 0x55, 0x55, 0x55, 0x55, 0x55, 0x55, 0x55, 0x55, 0x55, 0x55, 0x55,
   0x55, 0x55, 0x55, 0x00, 0x00, 0x00, 0x60, 0x00, 0x83, 0x03, 0x00, 0x07,
   0x00, 0x00, 0x00, 0x3c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x70, 0x80, 0xc3,
   0x01, 0x80, 0x03, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x38, 0xc0, 0xc1, 0x00, 0xc0, 0x01, 0x00, 0x00, 0x80, 0x07, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x18, 0xe0, 0xe0, 0x00, 0xe0, 0x00, 0x00, 0x00, 0xc0,
   0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1c, 0x60, 0x70, 0x00, 0x70, 0x00,
   0x00, 0x00, 0xf0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0c, 0x70, 0x38,
   0x00, 0x38, 0x00, 0x00, 0x00, 0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x0e, 0x38, 0x1c, 0x00, 0x1c, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x06, 0x18, 0x0c, 0x00, 0x0e, 0x00, 0x00, 0x00, 0x0f,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0x1c, 0x0e, 0x00, 0x07, 0x00,
   0x00, 0x80, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x03, 0x0e, 0x07,
   0x80, 0x03, 0x00, 0x00, 0xe0, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80,
   0x01, 0x87, 0x03, 0xc0, 0x01, 0x00, 0x00, 0xf0, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0xc0, 0x01, 0xc3, 0x01, 0xe0, 0x00, 0x00, 0x00, 0x3c, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x80, 0xc3, 0x00, 0x70, 0x00, 0x00,
   0x00, 0x1e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xe0, 0xc0, 0xe1, 0x00,
   0x38, 0x00, 0x00, 0x80, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x60,
   0xc0, 0x70, 0x00, 0x1c, 0x00, 0x00, 0xc0, 0x03, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x70, 0xe0, 0x38, 0x00, 0x0e, 0x00, 0x00, 0xf0, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x30, 0x70, 0x1c, 0x00, 0x07, 0x00, 0x00,
   0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x38, 0x38, 0x0c, 0x80,
   0x03, 0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1c,
   0x18, 0x0e, 0xc0, 0x01, 0x00, 0x00, 0x0f, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x0c, 0x1c, 0x07, 0xf0, 0x00, 0x00, 0xc0, 0x03, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x0e, 0x8e, 0x03, 0x78, 0x00, 0x00, 0xe0,
   0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x06, 0xc6, 0x01, 0x1c,
   0x00, 0x00, 0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07,
   0xc7, 0x00, 0x0e, 0x00, 0x00, 0x3c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x83, 0xe3, 0x00, 0x07, 0x00, 0x00, 0x0f, 0x00, 0x00, 0x00,
   0x00, 0x00, 0xe0, 0x55, 0x55, 0x55, 0x55, 0x55, 0x55, 0x55, 0x55, 0x55,
   0x55, 0x55, 0x55, 0x55, 0x55, 0x55, 0x00, 0xc0, 0xc1, 0x38, 0xc0, 0x01,
   0x00, 0xe0, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3f, 0x00, 0xc0, 0xe0,
   0x1c, 0xe0, 0x00, 0x00, 0xf0, 0x00, 0x00, 0x00, 0x00, 0x00, 0xe0, 0x0f,
   0x00, 0xe0, 0x70, 0x0c, 0x70, 0x00, 0x00, 0x3c, 0x00, 0x00, 0x00, 0x00,
   0x00, 0xf8, 0x01, 0x00, 0x60, 0x30, 0x0e, 0x38, 0x00, 0x00, 0x1e, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x3f, 0x00, 0x00, 0x70, 0x38, 0x07, 0x1c, 0x00,
   0x80, 0x07, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x0f, 0x00, 0x00, 0x30, 0x9c,
   0x03, 0x0e, 0x00, 0xc0, 0x03, 0x00, 0x00, 0x00, 0x00, 0xf8, 0x01, 0x00,
   0x00, 0x38, 0xcc, 0x01, 0x07, 0x00, 0xf0, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x7e, 0x00, 0x00, 0x00, 0x1c, 0xce, 0x80, 0x03, 0x00, 0x78, 0x00, 0x00,
   0x00, 0x00, 0xc0, 0x0f, 0x00, 0x00, 0x00, 0x0c, 0xe7, 0xc0, 0x01, 0x00,
   0x1e, 0x00, 0x00, 0x00, 0x00, 0xf8, 0x03, 0x00, 0x00, 0x00, 0x8e, 0x73,
   0xe0, 0x00, 0x00, 0x0f, 0x00, 0x00, 0x00, 0x00, 0x7e, 0x00, 0x00, 0x00,
   0x00, 0x86, 0x39, 0x70, 0x00, 0xc0, 0x03, 0x00, 0x00, 0x00, 0xc0, 0x0f,
   0x00, 0x00, 0x00, 0x00, 0xc7, 0x1d, 0x38, 0x00, 0xe0, 0x01, 0x00, 0x00,
   0x00, 0xf0, 0x03, 0x00, 0x00, 0x00, 0x00, 0xe3, 0x0e, 0x1c, 0x00, 0x78,
   0x00, 0x00, 0x00, 0x00, 0x7e, 0x00, 0x00, 0x00, 0x00, 0x80, 0x63, 0x06,
   0x0e, 0x00, 0x3c, 0x00, 0x00, 0x00, 0xc0, 0x1f, 0x00, 0x00, 0x00, 0x00,
   0xc0, 0x71, 0x07, 0x07, 0x00, 0x0f, 0x00, 0x00, 0x00, 0xf0, 0x03, 0x00,
   0x00, 0x00, 0x00, 0xc0, 0xb8, 0x83, 0x03, 0x80, 0x07, 0x00, 0x00, 0x00,
   0x7e, 0x00, 0x00, 0x00, 0x00, 0x00, 0xe0, 0xdc, 0xc1, 0x01, 0xe0, 0x01,
   0x00, 0x00, 0x80, 0x1f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x60, 0xec, 0xe0,
   0x00, 0xf0, 0x00, 0x00, 0x00, 0xf0, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x70, 0x6e, 0x70, 0x00, 0x3c, 0x00, 0x00, 0x00, 0xfe, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x30, 0x77, 0x38, 0x00, 0x1e, 0x00, 0x00, 0x80, 0x1f,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x38, 0x3b, 0x1c, 0x80, 0x07, 0x00,
   0x00, 0xf0, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x9c, 0x1f, 0x0e,
   0xc0, 0x03, 0x00, 0x00, 0xfc, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0xcc, 0x0f, 0x07, 0xe0, 0x00, 0x00, 0x80, 0x1f, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0xee, 0xc6, 0x03, 0x78, 0x00, 0x00, 0xe0, 0x07, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x55, 0x55, 0x55, 0x55, 0x55, 0x55,
   0x55, 0x55, 0x55, 0x55, 0x55, 0x55, 0x55, 0x55, 0x55, 0xf7, 0x73, 0x00,
   0x0f, 0x00, 0x80, 0x3f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0xfb, 0x39, 0x80, 0x07, 0x00, 0xe0, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0xfb, 0x1c, 0xe0, 0x01, 0x00, 0xfc, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7d, 0x0e, 0xf0, 0x00, 0x00, 0x3f,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7e, 0x07, 0x3c,
   0x00, 0xe0, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0xbf, 0x03, 0x1e, 0x00, 0xfc, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0xdf, 0x81, 0x07, 0x00, 0x3f, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xef, 0xc0, 0x03, 0xe0, 0x07, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x77, 0xf0, 0x00,
   0xf8, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x3f, 0x78, 0x00, 0x3f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x1f, 0x1e, 0xe0, 0x0f, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0f, 0x0f, 0xf8, 0x01, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc7, 0x03, 0x3f,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0xe3, 0xc1, 0x0f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x79, 0xf8, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3c, 0x7e, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xcf, 0x0f, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0xff, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x7f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0f, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 };

void drawGiya(void)
{
  X=NOWKMH-147;                         //車速（0-180キロ）で上下。グラフ下部左の起点は（8,32）。絵サイズが180（絵の上端0だと下端は179）なので、147ずらし。
  u8g2.drawXBMP( 8, X, GYH__width ,GYH__height ,GYH__bits);
}
*/
// オープニングロゴとギヤ比グラフの宣言終了 --->


// <--- 各ギヤ回転数を演算する関数の宣言

   void Rpm_Calc(){
   RPM1=(NOWKMH*5.087*25.2820176)+99;  //ギヤ変更後の回転数が、実際より100RPM程度低いため、ここで＋99して補正
   RPM1=RPM1*0.01;                      //ギヤ表示の2桁を00にする
   RPM1=RPM1*100;
   if(RPM1>7500){
    RPM1=9999.00;
   }
   RPM2=(NOWKMH*2.991*25.2820176)+99;
   RPM2=RPM2*0.01;
   RPM2=RPM2*100;
   if(RPM2>7500){
    RPM2=9999.00;
   }
   RPM3=(NOWKMH*2.035*25.2820176)+99;
   RPM3=RPM3*0.01;
   RPM3=RPM3*100;
   if(RPM3>7500){
    RPM3=9999.00;
   }
   RPM4=(NOWKMH*1.594*25.2820176)+99;
   RPM4=RPM4*0.01;
   RPM4=RPM4*100;
   if(RPM4>7500){
    RPM4=9999.00;
   }
   RPM5=(NOWKMH*1.286*25.2820176)+99;
   RPM5=RPM5*0.01;
   RPM5=RPM5*100;
   if(RPM5>7500){
    RPM5=9999.00;
   }
   RPM6=(NOWKMH*1.000*25.2820176)+99;
   RPM6=RPM6*0.01;
   RPM6=RPM6*100;
   if(RPM6>7500){
    RPM6=9999.00;
   }
   RRPM=(NOWKMH*4.696*25.2820176)+99;
   RRPM=RRPM*0.01;
   RRPM=RRPM*100;
   if(RRPM>7500){
    RRPM=9999.00;
   }
//   SerialUSB.print(" RPM1:");         //デバック用、各値の表示
//   SerialUSB.print(RPM1);
//   SerialUSB.print(" RPM2:");
//   SerialUSB.print(RPM2);
//   SerialUSB.print(" RPM3:");
//   SerialUSB.print(RPM3);
//   SerialUSB.print(" RPM4:");
//   SerialUSB.print(RPM4);
//   SerialUSB.print(" RPM5:");
//   SerialUSB.print(RPM5);
//   SerialUSB.print(" RPM6:");
//   SerialUSB.print(RPM6);
//   SerialUSB.print(" RRPM:");
//   SerialUSB.print(RRPM);
//   SerialUSB.println();
   }

// 各ギヤ回転数を演算する関数の終了 --->

/*
// <--- 現在ギヤが取得できない時の代理ギヤ処理関数開始

   void proxy_giya()
   {
   if(NOWKMH<10){                        //10kmh以下の時はニュートラルに
    NEWSHIFT=0;
   }
   if((NOWRPM)<550){                    //850rpm以下の時はニュートラルに
    NEWSHIFT=0;
   }
   else if(NOWRPM>(RPM1-50)){           //1速ギヤラインのプラスマイナス50以内は1速に
    NEWSHIFT=1;
   }
   else if(NOWRPM<(RPM1+50)){
    NEWSHIFT=1;
   }
   else if(NOWRPM>(RPM2-50)){           //2速ギヤラインのプラスマイナス50以内は2速に
    NEWSHIFT=2;
   }
   else if(NOWRPM<(RPM2+50)){
    NEWSHIFT=2;
   }
   else if(NOWRPM>(RPM3-50)){           //3速ギヤラインのプラスマイナス50以内は3速に
    NEWSHIFT=3;
   }
   else if(NOWRPM<(RPM3+50)){
    NEWSHIFT=3;
   }
   else if(NOWRPM>(RPM4-50)){           //4速ギヤラインのプラスマイナス50以内は4速に
    NEWSHIFT=4;
   }
   else if(NOWRPM<(RPM4+50)){
    NEWSHIFT=4;
   }
   else if(NOWRPM>(RPM5-50)){           //5速ギヤラインのプラスマイナス50以内は5速に
    NEWSHIFT=5;
   }
   else if(NOWRPM<(RPM5+50)){
    NEWSHIFT=5;
   }
   else if(NOWRPM>(RPM6-50)){           //6速ギヤラインのプラスマイナス50以内は6速に
    NEWSHIFT=6;
   }
   else if(NOWRPM<(RPM6+50)){
    NEWSHIFT=6;
   }
   else {                           //ギヤラインのプラスマイナス50以外はニュートラルに
    NEWSHIFT=0;
   }
   }

// 現在ギヤが取得できない時の代理ギヤ処理関数の終了 --->
*/

// <--- CAN読み取り、1次処理関数開始

void canbus_read()
{
    if(!digitalRead(7))                // D7ピンがCANシールドよりLOになったら、割り込みで処理開始
    {
      CAN0.readMsgBuf(&rxId, &len, rxBuf); // Read data: len = data length, buf = data byte(s)
      //SerialUSB.print("ID: ");
      //SerialUSB.print(rxId, HEX);
      //SerialUSB.print(" Data: ");
      //for(int i = 0; i<len; i++)           // Print each byte of the data
      //{
       // if(rxBuf[i] < 0x10)                // If data byte is less than 0x10, add a leading zero
        //{
          //SerialUSB.print("0");
        //}
        //SerialUSB.print(rxBuf[i], HEX);
        //SerialUSB.print(" ");
      //}
      //SerialUSB.println();
      
      if(rxId == 0x9A){                   //IDが09Aのライト状態か？
        uint16_t CANLIGHT=(uint16_t)rxBuf[0];
                                          //一番左の1バイト分を変数に取り込み
        switch(CANLIGHT){   
          case 0x00:LIGHT=0;              //ライト状態が00でライトOFFなら0をセット
                  //SerialUSB.print("LIGHT_0"); //デバック用、if内に入ったことを表示
                  //SerialUSB.println();
          break;
          case 0x20:LIGHT=1;              //ライト状態が20でライトスモールなら1をセット
                  //SerialUSB.print("LIGHT_1"); //デバック用、if内に入ったことを表示
                  //SerialUSB.println();
          break;
          case 0x30:LIGHT=2;              //ライト状態が30でライトロービームなら2をセット
                  //SerialUSB.print("LIGHT_2"); //デバック用、if内に入ったことを表示
                  //SerialUSB.println();
          break;
          case 0xC0:LIGHT=2;              //ライト状態がC0でライトハイビームなら2をセット
                  //SerialUSB.print("LIGHT_3"); //デバック用、if内に入ったことを表示
                  //SerialUSB.println();
          break;
          default:LIGHT=0;                //ライト状態が上記以外なら2をセット（予定外データの時はライトOFFと同じに）
                  //SerialUSB.print("LIGHT_ERR2"); //デバック用、if内に入ったことを表示
                  //SerialUSB.println();
        }
      }
      else if(rxId==0x202){              //IDが202の車速回転数状態か？

        uint16_t CANRPM = (uint16_t)rxBuf[0] << 8;
                                         //一番左の1バイト分を横にシフトしてから変数に取り込み
        CANRPM |= rxBuf[1];              //左から2番目の1バイト分をORで合体して、変数に取り込み
        
        NEWRPM=CANRPM*707/2850;          //回転数計算の数式に当てはめ、結果を変数に取り込み
        //SerialUSB.print("CANRPM：");     //デバック用、if内に入ったことを表示
        //SerialUSB.print(NEWRPM);         //デバック用、if内に入ったことを表示
        //SerialUSB.println();
        
        uint16_t CANKMH = (uint16_t)rxBuf[2] << 8;
                                         //左から3番目の1バイト分を横にシフトしてから変数に取り込み
        CANKMH |= rxBuf[3];              //左から4番目の1バイト分をORで合体して、変数に取り込み
        NEWKMH=CANKMH/100;               //車速計算の数式に当てはめ、結果を変数に取り込み
        //SerialUSB.print("CANKMH：");     //デバック用、if内に入ったことを表示
        //SerialUSB.print(NEWKMH);         //デバック用、if内に入ったことを表示
        //SerialUSB.println();
      }
      
      else if(rxId==0x165){              //IDが165のギヤ状態か？
        uint16_t CANSHIFT=(uint16_t)rxBuf[6];
                                         //左から7番目の1バイト分を変数に取り込み
        uint16_t REVSHIFT=(uint16_t)rxBuf[4];
                                         //左から5番目の1バイト分を変数に取り込み
        uint16_t CANCLUTCH=(uint16_t)rxBuf[2];
                                         //左から3番目の1バイト分を変数に取り込み
        switch(CANSHIFT){   
          case 0x13:NEWSHIFT=1;          //ギヤ状態が13で1速なら1をセット
          //SerialUSB.print("SHIFT_1");    //デバック用、if内に入ったことを表示
          //SerialUSB.println();
          break;
          
          case 0x0B:NEWSHIFT=2;          //ギヤ状態が0Bで2速なら2をセット
          //SerialUSB.print("SHIFT_2");    //デバック用、if内に入ったことを表示
          //SerialUSB.println();
          break;
          
          case 0x07:NEWSHIFT=3;          //ギヤ状態が07で3速なら3をセット
          //SerialUSB.print("SHIFT_3");    //デバック用、if内に入ったことを表示
          //SerialUSB.println();
          break;
          
          case 0x06:NEWSHIFT=4;          //ギヤ状態が06で4速なら4をセット
          //SerialUSB.print("SHIFT_4");    //デバック用、if内に入ったことを表示
          //SerialUSB.println();
          break;
          
          case 0x05:NEWSHIFT=5;          //ギヤ状態が05で5速なら5をセット
          //SerialUSB.print("SHIFT_5");    //デバック用、if内に入ったことを表示
          //SerialUSB.println();
          break;
          
          case 0x03:NEWSHIFT=6;          //ギヤ状態が03で6速なら6をセット
          //SerialUSB.print("SHIFT_6");    //デバック用、if内に入ったことを表示
          //SerialUSB.println();
          break;
          
          default:NEWSHIFT=0;            //ギヤ状態が上記以外はニュートラルとして0をセット（予定外データの時も0でニュートラル扱い）
          //SerialUSB.print("SHIFT_DEF_N"); //デバック用、if内に入ったことを表示
          //SerialUSB.println();
        }
        if(REVSHIFT==0xC8){
           if(CANSHIFT==0x13){          //ギヤ状態が13の1速で、かつ0xC8ならRをセット（0xC8になるのは6速でもなるためAND条件）
            NEWSHIFT=7;
            //SerialUSB.print("SHIFT_R"); //デバック用、if内に入ったことを表示
            //SerialUSB.println();
           }
        }
        //if(NEWKMH<5){                   //時速kmhが設定値以下なら強制的にN表示に
        //  NEWSHIFT=0;                   
        //}
        
        if(CANCLUTCH>0x17){
          CLUTCH=1;
          //SerialUSB.print("CLUTCH_ON"); //デバック用、if内に入ったことを表示
          //SerialUSB.println();
        }
        else{
          CLUTCH=0;
        }
      }

    }
}

// CAN読み取り、1次処理関数終了 --->



// <--- セットアップ関数開始

void setup() {
    SerialUSB.begin(115200);
    delay(3000);
    SerialUSB.println(F("●ND ROADSTER TRANSPARENT OLED HUD SYSTEM●"));
    u8g2.begin();
    SPI.begin();
    
    time_logo=millis();                //マイコン起動経過時間を取得
    time_disp=millis();                //マイコン起動経過時間を取得
    
    if(CAN0.begin(MCP_STDEXT, CAN_500KBPS, MCP_16MHZ) == CAN_OK) SerialUSB.print("MCP2515 Init Okay!!\r\n");
    else SerialUSB.print("MCP2515 Init Failed!!\r\n");
                                       // CAN初期化を実行（1行実行なのでカッコ無し）
    pinMode(7, INPUT);                 // CAN受信の割り込み用ピンD7を入力端子として指定（1行実行なのでカッコ無し）

    CAN0.init_Mask(0,0,0x0FFF0000);    // マスク0を設定、優先バッファのバッファ0用、1が立っている所をフィルタ設定とで比較、アドレス部分を完全同一のみにしています。
    CAN0.init_Filt(0,0,0x02020000);    // フィルタ0を設定、優先バッファのバッファ0用、ピッタリ合う奴のみ表示させています。
    CAN0.init_Filt(1,0,0x009A0000);    // フィルタ1を設定、優先バッファのバッファ0用、
    CAN0.init_Mask(1,0,0x0FFF0000);    // マスク1を設定、サブバッファのバッファ1用、1が立っている所をフィルタ設定とで比較、こちらはサブ
    CAN0.init_Filt(2,0,0x01650000);    // フィルタ2を設定、サブバッファのバッファ1用、
    CAN0.init_Filt(3,0,0x01650000);    // フィルタ3を設定、サブバッファのバッファ1用、同上。全設定を入れておかないと、前設定が電源断でも残るので注意。
    CAN0.init_Filt(4,0,0x01650000);    // フィルタ4を設定、サブバッファのバッファ1用、同上
    CAN0.init_Filt(5,0,0x01650000);    // フィルタ5を設定、サブバッファのバッファ1用、同上
    //CAN0.init_Filt(5,0,0x009A0000);    // フィルタ5を設定、サブバッファのバッファ1用、同上
  
    SerialUSB.println("MCP2515 Library Mask & Filter...");
    CAN0.setMode(MCP_NORMAL);          // Change to normal mode to allow messages to be transmitted

}

// セットアップ関数終了 --->


// <--- ループ開始
void loop() {
  
    canbus_read();                      //CAN読み取り関数
    //NEWKMH=20;                        //表示確認用、テストで固定値
    //NEWRPM=7100;                      //表示確認用、テストで固定値
    //NEWSHIFT=2;                       //表示確認用、テストで固定値
    

    if(millis()-time_disp>100){          //表示周期を一定にする条件分岐    
    u8g2.firstPage();                   //表示用宣言
    do{

    u8g2.clearBuffer();
    
    switch(LIGHT){
    case 0:                             //ライト消灯の時、輝度最大
        u8g2.setContrast(255);          //0-128程度まで変化した。それ以上は変化がわからなかった
        break;
    case 1:                             //スモールの時、輝度半分
        u8g2.setContrast(64);
        break;
    case 2:                             //ライト点灯の時、輝度最低
        u8g2.setContrast(0);
        break;
    default:
        u8g2.setContrast(255);          //条件以外の時、輝度最大（予定外データ用）
    } 


    if((millis()-time_logo)<1000){

    drawLogo1();
    }
    
    else if((millis()-time_logo)<7000){
    drawLogo2();
    }
    
    else{

    NOWKMH=NEWKMH;
    NOWRPM=NEWRPM;
    

    Rpm_Calc();                          //各ギヤ比を演算

//    proxy_giya();                        //CANからギヤデータを取得できない時の代理ギヤ演算

    NOWRPM=NOWRPM*0.01;                  //NOWRPMの下2桁を0にする
    NOWRPM=NOWRPM*100;


    u8g2.setDrawColor(1);


    u8g2.drawPixel(0, 60);                //棒グラフの点線1000rpm左
    u8g2.drawPixel(24, 60);               //棒グラフの点線1000rpm右
    u8g2.drawPixel(0, 50);                //棒グラフの点線2000rpm左
    u8g2.drawPixel(24, 50);               //棒グラフの点線2000rpm右
    u8g2.drawPixel(0, 40);                //棒グラフの点線3000rpm左
    u8g2.drawPixel(24, 40);               //棒グラフの点線3000rpm右
    u8g2.drawPixel(0, 30);                //棒グラフの点線4000rpm左
    u8g2.drawPixel(24, 30);               //棒グラフの点線4000rpm右
    u8g2.drawPixel(0, 20);                //棒グラフの点線5000rpm左
    u8g2.drawPixel(24, 20);               //棒グラフの点線5000rpm右
    u8g2.drawPixel(0, 10);                //棒グラフの点線6000rpm左
    u8g2.drawPixel(24, 10);               //棒グラフの点線6000rpm右
    u8g2.drawPixel(0, 0);                //棒グラフの点線7000rpm左
    u8g2.drawPixel(24, 0);               //棒グラフの点線7000rpm右   

    


    u8g2.setFont(u8g2_font_profont22_tr);
    u8g2.setCursor(79,40);
    u8g2.print(NOWRPM);                //現在回転数表示

    u8g2.setFont(u8g2_font_lubBI08_tr);    
    u8g2.drawStr(38,18,"DW");          //シフトダウン時回転数欄用DW表示
    u8g2.drawStr(38,63,"UP");          //シフトアップ時回転数欄用UP表示



    if(NEWSHIFT!=0){                    //現在ギヤが1～6速なら、ギヤ代入
     NOWSHIFT=NEWSHIFT;                 //現在ギヤがニュートラルなら、前のままのギヤ表示になるように代入部分を通さずギヤ代入をキャンセル
    }
    
    
    switch(NOWSHIFT){                   //現在ギヤによる表示値の変更、0=N、1=1st、2=2st、3=3rd、4=4th、5=5th、6=6th、7=R、default=N
    case 0:
    u8g2.setCursor(64,21);
    u8g2.setFont(u8g2_font_profont29_tr);
    u8g2.print(RRPM);                   //上側ダウン回転数表示
    u8g2.setCursor(64,63);
    u8g2.print(RPM1);                   //下側アップ回転数表示
    u8g2.setFont(u8g2_font_luBIS18_tr);
    u8g2.drawStr(24,42," N ");          //中央シフト表示
    X=(RRPM/100)-7;
    if(X<0){                            //値がマイナスの時は0を代入
      X=0;
      }
      X=63-X;
    u8g2.drawLine(0,X,24,X);            //グラフの上側回転数ライン表示
    X=(RPM1/100)-7;
    if(X<0){                            //値がマイナスの時は0を代入
      X=0;
      }
      X=63-X;
    u8g2.drawLine(0,X,24,X);            //グラフの下側回転数ライン表示
    break;
    
    case 1:
    u8g2.setFont(u8g2_font_profont29_tr);
    u8g2.drawStr(64,21,"0");             //上側ダウン回転数表示
    u8g2.setCursor(64,63);
    u8g2.print(RPM2);                   //下側アップ回転数表示
    u8g2.setFont(u8g2_font_luBIS18_tr);
    u8g2.drawStr(24,42,"1st");          //中央シフト表示
     X=0;
     X=63-X;
    u8g2.drawLine(0,X,24,X);            //グラフの上側回転数ライン表示
    X=(RPM2/100)-7;
    if(X<0){                            //値がマイナスの時は0を代入
      X=0;
      }
      X=63-X;
    u8g2.drawLine(0,X,24,X);            //グラフの下側回転数ライン表示
    break;
    
    case 2:
    u8g2.setCursor(64,21);
    u8g2.setFont(u8g2_font_profont29_tr);
    u8g2.print(RPM1);                  //上側ダウン回転数表示
    u8g2.setCursor(64,63);
    u8g2.print(RPM3);                  //下側アップ回転数表示
    u8g2.setFont(u8g2_font_luBIS18_tr);
    u8g2.drawStr(24,42,"2nd");         //中央シフト表示
    X=(RPM1/100)-7;
    if(X<0){                            //値がマイナスの時は0を代入
      X=0;
      }
      X=63-X;
    u8g2.drawLine(0,X,24,X);            //グラフの上側回転数ライン表示
    X=(RPM3/100)-7;
    if(X<0){                            //値がマイナスの時は0を代入
      X=0;
      }
      X=63-X;
    u8g2.drawLine(0,X,24,X);            //グラフの下側回転数ライン表示
    break;
    
    case 3:
    u8g2.setCursor(64,21);
    u8g2.setFont(u8g2_font_profont29_tr);
    u8g2.print(RPM2);                 //上側ダウン回転数表示
    u8g2.setCursor(64,63);
    u8g2.print(RPM4);                 //下側アップ回転数表示
    u8g2.setFont(u8g2_font_luBIS18_tr);
    u8g2.drawStr(24,42,"3rd");        //中央シフト表示
    X=(RPM2/100)-7;
    if(X<0){                            //値がマイナスの時は0を代入
      X=0;
      }
      X=63-X;
    u8g2.drawLine(0,X,24,X);            //グラフの上側回転数ライン表示
    X=(RPM4/100)-7;
    if(X<0){                            //値がマイナスの時は0を代入
      X=0;
      }
      X=63-X;
    u8g2.drawLine(0,X,24,X);            //グラフの下側回転数ライン表示
    break;
    
    case 4:
    u8g2.setCursor(64,21);
    u8g2.setFont(u8g2_font_profont29_tr);
    u8g2.print(RPM3);                  //上側ダウン回転数表示
    u8g2.setCursor(64,63);
    u8g2.print(RPM5);                  //下側アップ回転数表示
    u8g2.setFont(u8g2_font_luBIS18_tr);
    u8g2.drawStr(24,42,"4th");         //中央シフト表示
    X=(RPM3/100)-7;
    if(X<0){                            //値がマイナスの時は0を代入
      X=0;
      }
      X=63-X;
    u8g2.drawLine(0,X,24,X);            //グラフの上側回転数ライン表示
    X=(RPM5/100)-7;
    if(X<0){                            //値がマイナスの時は0を代入
      X=0;
      }
      X=63-X;
    u8g2.drawLine(0,X,24,X);            //グラフの下側回転数ライン表示
    break;
    
    case 5:
    u8g2.setCursor(64,21);
    u8g2.setFont(u8g2_font_profont29_tr);
    u8g2.print(RPM4);                  //上側ダウン回転数表示
    u8g2.setCursor(64,63);
    u8g2.print(RPM6);                  //下側アップ回転数表示
    u8g2.setFont(u8g2_font_luBIS18_tr);
    u8g2.drawStr(24,42,"5th");         //中央シフト表示
    X=(RPM4/100)-7;
    if(X<0){                            //値がマイナスの時は0を代入
      X=0;
      }
      X=63-X;
    u8g2.drawLine(0,X,24,X);            //グラフの上側回転数ライン表示
    X=(RPM6/100)-7;
    if(X<0){                            //値がマイナスの時は0を代入
      X=0;
      }
      X=63-X;
    u8g2.drawLine(0,X,24,X);            //グラフの下側回転数ライン表示
    break;
    
    case 6:
    u8g2.setCursor(64,21);
    u8g2.setFont(u8g2_font_profont29_tr);
    u8g2.print(RPM5);                  //上側ダウン回転数表示
    u8g2.drawStr(64,63,"0");           //下側アップ回転数表示
    u8g2.setFont(u8g2_font_luBIS18_tr);
    u8g2.drawStr(24,42,"6th");         //中央シフト表示
    X=(RPM5/100)-7;
    if(X<0){                            //値がマイナスの時は0を代入
      X=0;
      }
      X=63-X;
    u8g2.drawLine(0,X,24,X);            //グラフの上側回転数ライン表示
    X=0;
    X=63-X;
    u8g2.drawLine(0,X,24,X);            //グラフの下側回転数ライン表示
    break;
    
    case 7:
    u8g2.setFont(u8g2_font_profont29_tr);
    u8g2.drawStr(64,21,"0");           //上側ダウン回転数表示
    u8g2.drawStr(64,63,"0");           //下側アップ回転数表示

    u8g2.setFont(u8g2_font_luBIS18_tr);
    u8g2.drawStr(24,42," R ");         //中央シフト表示
    X=0;
    X=63-X;
    u8g2.drawLine(0,X,24,X);            //グラフの上側回転数ライン表示
    X=(RRPM/100)-7;
    if(X<0){                            //値がマイナスの時は0を代入
      X=0;
      }
      X=63-X;
    u8g2.drawLine(0,X,24,X);            //グラフの下側回転数ライン表示
    break;
    
    default:
    u8g2.setCursor(64,21);
    u8g2.setFont(u8g2_font_profont29_tr);
    u8g2.print(RRPM);                  //上側ダウン回転数表示
    u8g2.setCursor(64,63);
    u8g2.print(RPM1);                  //下側アップ回転数表示
    u8g2.setFont(u8g2_font_luBIS18_tr);
    u8g2.drawStr(24,42," N ");         //中央シフト表示
    X=(RRPM/100)-7;
    if(X<0){                            //値がマイナスの時は0を代入
      X=0;
      }
      X=63-X;
    u8g2.drawLine(0,X,24,X);            //グラフの上側回転数ライン表示
    X=(RPM1/100)-7;
    if(X<0){                            //値がマイナスの時は0を代入
      X=0;
      }
      X=63-X;
    u8g2.drawLine(0,X,24,X);            //グラフの下側回転数ライン表示
    
    }



    u8g2.setDrawColor(2);          //塗りつぶしを反転表示
    if((NOWRPM/100)>7){
      X=(NOWRPM/100)-7;             //700-7000回転までの6400幅でドット幅64（＝100分の1）。700rpm分ずらし。バーグラフ起点の左下は（0,63）
    }
    else{
      X=0;                          //700rpm以下で、Xがマイナスだと整数の数値反転で最大値になり、バーがマックスになるため、0を代入
    }
    u8g2.drawBox(0,(63-X),24,X);    //回転数のバー表示
    u8g2.setDrawColor(1);           //通常表示に戻し

    if((NOWRPM/100)<=69){            //7000rpm以下か？
      time_shiftlamp=millis();      //7000rpm以下なら、マイコン起動経過時間を変数に入れ、次の表示周期へ
    }
    else{
      if((millis()-time_shiftlamp)>300){
                                     //7000rpm以上で、7000rpm以上の時間が設定msec以下か？
        u8g2.setDrawColor(0);        //塗りつぶしを反転表示
        u8g2.drawBox(0,0,24,64);     //回転数のバー表示を最大サイズで描画
        u8g2.setDrawColor(1);        //通常表示に戻し

      }
      //else{
        if((millis()-time_shiftlamp)>400){
                                     //7000rpm以上で、7000rpm以上の時間が設定msec以下か？
      //    u8g2.setDrawColor(0);      //反転表示 
      //    u8g2.drawBox(0,0,24,64);   //回転数のバー表示を最大サイズで描画
      //    u8g2.setDrawColor(1);      //通常表示に戻し
        time_shiftlamp=millis();   //マイコン起動経過時間を変数に入れ、次の表示周期へ
          }                           //7000rpm以上で、7000rpm以上の時間が設定msec以上か？

    }

   }
}while(u8g2.nextPage());
    time_disp=millis();                //マイコン起動経過時間を変数に入れ、次の表示周期へ
}
}

// ループ終了 --->
